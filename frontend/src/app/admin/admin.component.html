<div class="admin-layout">
  
  <header class="admin-header">
    <div class="header-title">
      <mat-icon class="header-icon">admin_panel_settings</mat-icon>
      <h1>System Control</h1>
    </div>
    <p class="header-subtitle">Overview of platform metrics and moderation queues.</p>
  </header>

  <div class="stats-grid">
    <mat-card class="stat-card">
      <div class="stat-icon-box blue">
        <mat-icon>group</mat-icon>
      </div>
      <div class="stat-info">
        <span class="stat-label">Total Users</span>
        <span class="stat-value">{{ totalUsers }}</span>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-icon-box green">
        <mat-icon>article</mat-icon>
      </div>
      <div class="stat-info">
        <span class="stat-label">Total Posts</span>
        <span class="stat-value">{{ totalPosts }}</span>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-icon-box red">
        <mat-icon>warning</mat-icon>
      </div>
      <div class="stat-info">
        <span class="stat-label">Pending Reports</span>
        <span class="stat-value warning-text">{{ pendingReports }}</span>
      </div>
    </mat-card>
  </div>

  <mat-tab-group class="tech-tabs" mat-stretch-tabs="false" mat-align-tabs="start">
    
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">flag</mat-icon> Reports
      </ng-template>
      
      <div class="table-container mat-elevation-z0">
        <table mat-table [dataSource]="reports" class="tech-table">
          
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let report" class="mono-text"> #{{report.id}} </td>
          </ng-container>

          <ng-container matColumnDef="reporter">
            <th mat-header-cell *matHeaderCellDef> REPORTER </th>
            <td mat-cell *matCellDef="let report" class="highlight-text"> {{report.reporterUsername}} </td>
          </ng-container>

          <ng-container matColumnDef="reason">
            <th mat-header-cell *matHeaderCellDef> REASON </th>
            <td mat-cell *matCellDef="let report"> {{report.reason}} </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> STATUS </th>
            <td mat-cell *matCellDef="let report"> 
              <span class="status-badge" [class.pending]="report.status === 'PENDING'">
                {{report.status}}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-right"> ACTIONS </th>
            <td mat-cell *matCellDef="let report" class="text-right">
              <button mat-stroked-button color="primary" class="small-btn" (click)="resolveReport(report)">
                Dismiss
              </button>
              <button mat-stroked-button color="primary" class="small-btn" (click)="deletePost(report.reportedPostId)">
                Delete
              </button>
              @if (!report.hidden){
              <button mat-stroked-button color="primary" class="small-btn" (click)="hidePost(report.reportedPostId)">
                Hide
              </button>} @else {
              <button mat-stroked-button color="primary" class="small-btn" (click)="unHidePost(report.reportedPostId)">
                Unhide
              </button>
            }
             @if (report.banned){
              <button mat-flat-button color="warn" class="small-btn delete-btn" (click)="banEntity(report)">
                Unban
              </button>
            }@else {
              <button mat-flat-button color="warn" class="small-btn delete-btn" (click)="banEntity(report)">
                ban
              </button>
            }>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="reportColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: reportColumns;"></tr>
        </table>
      </div>
    </mat-tab>
    
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">people</mat-icon> Users
      </ng-template>

      <div class="table-container mat-elevation-z0">
        <table mat-table [dataSource]="users" class="tech-table">
          
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef> USERNAME </th>
            <td mat-cell *matCellDef="let user" class="highlight-text"> 
              <img [src]="'https://api.dicebear.com/9.x/initials/svg?seed=' + user.username" class="mini-avatar">
              {{user.username}} 
            </td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef> ROLE </th>
            <td mat-cell *matCellDef="let user"> 
              <span class="role-badge">{{user.role}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-right"> ACTIONS </th>
            <td mat-cell *matCellDef="let user" class="text-right">
              <button mat-stroked-button 
                      [color]="user.banned ? 'accent' : 'warn'" 
                      class="small-btn"
                      (click)="toggleBan(user)">
                {{ user.banned ? 'Unban User' : 'Ban User' }}
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
        </table>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>