<div class="app-layout">
  @if (authService.isLoggedIn()) {
  <header class="tech-header mat-elevation-z2">
    <div class="header-container">
      
      <div class="header-start">
        <a routerLink="/" class="tech-brand">
          <span class="brand-bracket">&lt;</span>
          01<span class="brand-text">Blog</span>
          <span class="brand-bracket">/&gt;</span>
        </a>

        <div class="search-block">
          <mat-icon class="search-icon">search</mat-icon>
          <input type="text" placeholder="Type / to search...">
          <span class="keyboard-hint">/</span>
        </div>
      </div>

      <div class="header-end">
        
        <button class="action-btn accent-btn">
          <a routerLink="/write" routerLinkActive="active" class="nav-item">
            <mat-icon>edit_note</mat-icon> Write Article
          </a>
        </button>

        <div class="divider-vertical"></div>

        <button mat-icon-button class="icon-action" [matMenuTriggerFor]="notifMenu" (click)="loadNotifications()">
          <mat-icon [matBadge]="unreadCount()" matBadgeColor="warn" [matBadgeHidden]="unreadCount() === 0">notifications</mat-icon>
        </button>

        <mat-menu #notifMenu="matMenu" xPosition="before" class="tech-menu">
            <div style="padding: 12px 16px; font-weight: bold; color: var(--text-main);">Notifications</div>
            <mat-divider></mat-divider>
            @for (notif of notifications(); track notif.id) {
                <button mat-menu-item (click)="markAsRead(notif.id)" [style.background]="notif.read ? 'transparent' : 'rgba(59, 130, 246, 0.1)'">
                    <mat-icon color="primary">info</mat-icon>
                    <span [style.font-weight]="notif.read ? 'normal' : 'bold'">{{ notif.message }}</span>
                </button>
            } @empty {
                <div style="padding: 16px; color: var(--text-secondary); text-align: center;">No new notifications</div>
            }
        </mat-menu>

        <button class="user-chip" [matMenuTriggerFor]="userMenu">
          <img [src]="'https://api.dicebear.com/9.x/initials/svg?seed=' + authService.currentUser()" alt="User">
          <span class="user-name">{{ authService.currentUser() }}</span>
          <mat-icon class="dropdown-arrow">expand_more</mat-icon>
        </button>
      </div>

      <mat-menu #userMenu="matMenu" xPosition="before" class="tech-menu">
        <button mat-menu-item [routerLink]="['/block', authService.currentUser()]">
          <mat-icon>person</mat-icon> <span>Profile</span>
        </button>
        <button mat-menu-item *ngIf="authService.isAdmin()" routerLink="/admin">
          <mat-icon>terminal</mat-icon> <span>Console</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>power_settings_new</mat-icon> <span>Disconnect</span>
        </button>
      </mat-menu>

    </div>
  </header>
  }

  <div class="content-area">
    <router-outlet></router-outlet>
  </div>
</div>